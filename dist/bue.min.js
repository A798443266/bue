/*!
* buejs v1.0.0
* Copyright (c) 2019 bowencool
* Released under the MIT License.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Bue=e()}(this,function(){"use strict";function t(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function e(t){"production"!==process.env.NODE_ENV&&console.warn(`[Bue Warn]: ${t}`)}function o(t){const e=(t+"").charCodeAt(0);return 36===e||95===e}function n(t,e){return Object.prototype.hasOwnProperty.call(t,e)}const s=(t,e)=>{if(e in t){return t[e]}let o=t;return e.split(".").forEach(t=>{o=o[t]}),o};let i=0;class r{constructor(t){this.watchers=new Set,this.id=i++,this.propertyName=t}addWatcher(t){this.watchers.add(t)}removeWatcher(t){this.watchers.delete(t)}notify(){console.log("dep.notify: ",this),this.watchers.forEach(t=>{t.update()})}depend(){r.target&&r.target.addDep(this)}}r.target=null;const c=[];function l(e,o){if(!e||"object"!=typeof e)return;console.log("OBSERVING",e);const s={},i={};return new Proxy(e,{get:(e,c,a)=>n(e,c)&&(console.log("\n"),console.group(`proxy get: ${c}`),s[c]||(s[c]=o||new r(c)),s[c].depend(),console.groupEnd(),function(e){const o=t(e);return"object"===o||"array"===o}(e[c]))?(i[c]||(i[c]=l(e[c],s[c])),i[c]):Reflect.get(e,c,a),set(t,e,o,n){console.log("\nset: ",e,o);const i=Reflect.set(t,e,o,n);let r=s[e];return r&&r.notify(),i}})}function a(s){!function(s){let{data:i,methods:r}=s.$options;if("object"===t(i=("function"==typeof i?i.call(s):i)||{})){const t=s._proxy=l(i);for(const c in i){if(r&&n(r,c))return e(`The data property "${c}" has already been declared as a method.`);o(c)?e(`The data property "${c}" is a reserved key.`):Object.defineProperty(s,c,{get:()=>t[c],set(e){t[c]=e}})}}}(s)}const d=t=>{if(!/[^\w.$]/.test(t))return e=>s(e,t)};let h=0;class p{constructor(t,e,o){this.deps=new Set,console.group("creating watcher: ",e),this.id=h++,this.bm=t,this.expOrFn=e,this.cb=o,this.getter="function"==typeof e?e:d(e),this.value=this.get(),console.groupEnd()}update(){console.group("watcher.update");const t=this.get(),e=this.value;this.value=t,this.cb.call(this.bm,t,e),console.log("updated:",t,e),console.groupEnd()}addDep(t){t.addWatcher(this),this.deps.add(t),console.log("addDep:",t,this)}get(){var t;console.group("watcher.get"),t=this,r.target&&c.push(r.target),r.target=t;const e=this.getter.call(this.bm,this.bm);return r.target=c.pop(),console.groupEnd(),e}}var u={text(t,e="none"){t.textContent=e},model(t,e=""){t.value=e}},f={text(t,e,o){this.bind(t,e,o,u.text)},model(t,e,o){this.bind(t,e,o,u.model);const n=function(t){const n=t.target.value;((t,e,o)=>{if(e in t)return void(t[e]=o);let n;e.split(".").forEach((t,e,s)=>{e<s.length-1?n=n[t]:n[t]=o})})(e,o,n)};t.addEventListener("input",n),t.addEventListener("change",n)},bind(t,e,o,n){console.group("compiler get initialValue:",o);const i=s(e,o);n&&n(t,i),console.groupEnd(),new p(e,o,function(e,o){n&&n(t,e,o)})},eventHandler(t,e,o,n){const s=e.$options.methods&&e.$options.methods[n];o&&s&&t.addEventListener(o,s.bind(e),!1)}};const g=t=>1==t.nodeType,m=t=>3==t.nodeType,y=t=>{const e=document.createDocumentFragment();for(;t.firstChild;)e.appendChild(t.firstChild);return e};class b{constructor(t,e){this.$el=e.$el=g(t)?t:document.querySelector(t),this.$bm=e,this.$el&&(this.$fragment=y(this.$el),this.compileElement(this.$fragment),this.$el.appendChild(this.$fragment))}compileElement(t){t.childNodes.forEach(t=>{g(t)?this.compileNode(t):m(t)&&/{{\s*(.*?)\s*}}/.test(t.textContent)&&this.compileText(t,RegExp.$1),t.childNodes&&t.childNodes.length&&this.compileElement(t)})}compileNode(t){Array.from(t.attributes).forEach(e=>{/^b-(\w+)/.test(e.name)?(f[RegExp.$1](t,this.$bm,e.value),t.removeAttribute(e.name)):/^@(\w+)/.test(e.name)&&(f.eventHandler(t,this.$bm,RegExp.$1,e.value),t.removeAttribute(e.name))})}compileText(t,e){f.text(t,this.$bm,e)}}let $=0;return class{constructor(o){this._uid=++$,this._isBue=!0,this.$options=o,a(this),function(o){const n=o.$options.computed;"object"===t(n)&&Object.keys(n).forEach(s=>{const i=n[s],r="function"===t(i);Object.defineProperty(o,s,{get:r?i:i.get.call(o),set:r?function(){e(`Avoiding modify the computed property "${s}" unless you provide an setter.`)}:function(){i.set.apply(o,arguments)}})})}(this),this.$compiler=new b(o.el,this)}}});
